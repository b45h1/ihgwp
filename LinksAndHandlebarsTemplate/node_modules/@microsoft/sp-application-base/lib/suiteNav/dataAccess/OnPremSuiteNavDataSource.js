import SuiteNavManager from '../SuiteNavManager';
import { _LogSource, _TraceLogger } from '@microsoft/sp-diagnostics';
import { SPHttpClient } from '@microsoft/sp-http';
var OnPremSuiteNavDataSource = (function () {
    function OnPremSuiteNavDataSource(httpClient, currentUICultureName, webServerRelativeUrl) {
        this.suiteNavService = 1 ;
        this._currentUICultureName = currentUICultureName;
        this._spHttpClient = httpClient;
        this._siteRelUrl = webServerRelativeUrl === '/' ? '' : webServerRelativeUrl;
    }
    OnPremSuiteNavDataSource.prototype.loadData = function () {
        var _this = this;
        var url = this._siteRelUrl
            + '/_api/Microsoft.SharePoint.Portal.SuiteNavData.GetSuiteNavData?v=2&Locale='
            + this._currentUICultureName;
        return this._spHttpClient.get(url, SPHttpClient.configurations.v1)
            .then(function (response) {
            if (response.status !== 200) {
                _this._logAndThrowSuiteNavLoadingError();
            }
            return response.json().then(function (jsonString) {
                if (jsonString.value === '') {
                    _this._logAndThrowSuiteNavLoadingError();
                }
                else {
                    var suiteNavResponse = JSON.parse(jsonString.value);
                    if (suiteNavResponse.NavBarData && !suiteNavResponse.NavBarData.Dimensions) {
                        suiteNavResponse.NavBarData.Dimensions = { Top: SuiteNavManager._defaultSuiteNavHeight };
                    }
                    return suiteNavResponse; 
                }
            });
        });
    };
    OnPremSuiteNavDataSource.prototype._logAndThrowSuiteNavLoadingError = function () {
        _TraceLogger.logVerbose(OnPremSuiteNavDataSource._logSource, 'Failed to retrieve Hybrid SuiteNavData');
        throw new Error('Failed to retrieve Hybrid SuiteNavData');
    };
    OnPremSuiteNavDataSource._logSource = _LogSource.create('OnPremSuiteNavDataSource');
    return OnPremSuiteNavDataSource;
}());
export default OnPremSuiteNavDataSource;
