{"version":3,"sources":["cli/logic/test/ShrinkwrapFile.test.ts"],"names":[],"mappings":"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","file":"ShrinkwrapFile.test.js","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { assert } from 'chai';\r\nimport * as path from 'path';\r\n\r\nimport { BaseShrinkwrapFile } from '../base/BaseShrinkwrapFile';\r\nimport { ShrinkwrapFileFactory } from '../ShrinkwrapFileFactory';\r\nimport { extractVersionFromPnpmVersionSpecifier } from '../pnpm/PnpmShrinkwrapFile';\r\n\r\ndescribe('npm ShrinkwrapFile', () => {\r\n  const filename: string = path.resolve(path.join(__dirname, './shrinkwrapFile/npm-shrinkwrap.json'));\r\n  const shrinkwrapFile: BaseShrinkwrapFile = ShrinkwrapFileFactory.getShrinkwrapFile('npm', filename)!;\r\n\r\n  it('verifies root-level dependency', () => {\r\n    assert.isTrue(shrinkwrapFile.hasCompatibleTopLevelDependency('q', '~1.5.0'));\r\n  });\r\n\r\n  it('verifies temp project dependencies', () => {\r\n    // Found locally\r\n    assert.isTrue(shrinkwrapFile.tryEnsureCompatibleDependency('jquery', '>=2.2.4 <3.0.0', '@rush-temp/project2'));\r\n    // Found at root\r\n    assert.isTrue(shrinkwrapFile.tryEnsureCompatibleDependency('q', '~1.5.0', '@rush-temp/project2'));\r\n  });\r\n\r\n  it('extracts temp projects successfully', () => {\r\n    const tempProjectNames: ReadonlyArray<string> = shrinkwrapFile.getTempProjectNames();\r\n\r\n    assert.deepEqual(tempProjectNames, ['@rush-temp/project1', '@rush-temp/project2' ]);\r\n  });\r\n});\r\n\r\ndescribe('pnpm ShrinkwrapFile', () => {\r\nconst filename: string = path.resolve(path.join(\r\n  __dirname, '../../../../src/cli/logic/test/shrinkwrapFile/shrinkwrap.yaml'));\r\nconst shrinkwrapFile: BaseShrinkwrapFile = ShrinkwrapFileFactory.getShrinkwrapFile('pnpm', filename)!;\r\n\r\n  it('verifies root-level dependency', () => {\r\n    assert.isFalse(shrinkwrapFile.hasCompatibleTopLevelDependency('q', '~1.5.0'));\r\n  });\r\n\r\n  it('verifies temp project dependencies', () => {\r\n    assert.isTrue(shrinkwrapFile.tryEnsureCompatibleDependency('jquery', '>=2.0.0 <3.0.0', '@rush-temp/project1'));\r\n    assert.isTrue(shrinkwrapFile.tryEnsureCompatibleDependency('q', '~1.5.0', '@rush-temp/project2'));\r\n    assert.isFalse(shrinkwrapFile.tryEnsureCompatibleDependency('left-pad', '~9.9.9', '@rush-temp/project1'));\r\n    assert.isTrue(\r\n      shrinkwrapFile.tryEnsureCompatibleDependency('@scope/testDep', '>=1.0.0 <2.0.0', '@rush-temp/project3'));\r\n  });\r\n\r\n  it('extracts temp projects successfully', () => {\r\n    const tempProjectNames: ReadonlyArray<string> = shrinkwrapFile.getTempProjectNames();\r\n\r\n    assert.deepEqual(tempProjectNames, ['@rush-temp/project1', '@rush-temp/project2', '@rush-temp/project3']);\r\n  });\r\n\r\n  it('can reuse the latest version that another temp package is providing', () => {\r\n    assert.isTrue(shrinkwrapFile.tryEnsureCompatibleDependency('jquery', '>=2.0.0 <3.0.0', '@rush-temp/project3'));\r\n  });\r\n});\r\n\r\ndescribe('extractVersionFromPnpmVersionSpecifier', () => {\r\n  it('extracts a simple version with no slashes', () => {\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('0.0.5'), '0.0.5');\r\n  });\r\n  it('extracts an unscoped peer dep', () => {\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('/gulp-karma/0.0.5/karma@0.13.22'), '0.0.5');\r\n  });\r\n  it('extracts a scoped peer dep', () => {\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('/@ms/sp-client-utilities/3.1.1/foo@13.1.0'), '3.1.1');\r\n  });\r\n  it('extracts relative versions', () => {\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('example.pkgs.visualstudio.com/@scope/testDep/1.0.0'), '1.0.0');\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier(\r\n      'example.pkgs.visualstudio.com/@scope/testDep/1.2.3-beta.3'), '1.2.3-beta.3');\r\n  });\r\n  it('handles bad cases', () => {\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('/foo/gulp-karma/0.0.5/karma@0.13.22'), undefined);\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('/@ms/3.1.1/foo@13.1.0'), undefined);\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier(''), undefined);\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('/'), undefined);\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('//'), undefined);\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('/@/'), undefined);\r\n    assert.equal(extractVersionFromPnpmVersionSpecifier('example.pkgs.visualstudio.com/@scope/testDep/'), undefined);\r\n  });\r\n});\r\n"],"sourceRoot":"../../../../../../../src"}