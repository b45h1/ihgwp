{"version":3,"sources":["webparts/handlebarTemplateDisplay/components/HandlebarTemplateDisplay.tsx"],"names":[],"mappings":"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","file":"webparts/handlebarTemplateDisplay/components/HandlebarTemplateDisplay.js","sourcesContent":["import * as React from 'react';\nimport * as strings from 'handlebarTemplateDisplayStrings';\nimport Handlebars = require('handlebars');\nimport moment = require('moment');\nimport 'file-saver';\nimport styles from './HandlebarTemplateDisplay.module.scss';\nimport LinkPickerPanel from \"../../../components/LinkPickerPanel/LinkPickerPanel\";\nimport { IHandlebarTemplateDisplayProps } from './IHandlebarTemplateDisplayProps';\nimport { LinkType } from \"../../../components/LinkPickerPanel/ILinkPickerPanelProps\";\nimport { Button, CommandButton } from \"office-ui-fabric-react/lib/Button\";\nimport { Modal } from 'office-ui-fabric-react/lib/Modal';\n\nconst specialChar = \"    \";\n\n//Handlebars.registerHelper(\"date\",(date: Date,format: string): string=>{\n//  return moment(date).format(format);\n//});\n\nexport default class HandlebarTemplateDisplay extends React.Component<IHandlebarTemplateDisplayProps, void> {\n  private linkPickerPanel: LinkPickerPanel;\n  \n  private _templateExport : string;\n  public get templateExport() : string {\n    return this._templateExport;\n  }\n  public set templateExport(v : string) {\n    this._templateExport = v;\n  }\n  \n  public setTitle(event){\n    this.props.setTitle(event.target.value);\n  }\n\n  public openTemplateLinkPicker(event){\n    if (this.linkPickerPanel) {\n      this.linkPickerPanel.pickLink()\n      .then (({name, url}) => {\n        this.props.setTemplateUrl(url, name);\n      });\n    }\n  }\n\n  public openStyleLinkPicker(event){\n    if (this.linkPickerPanel) {\n      this.linkPickerPanel.pickLink()\n      .then (({name, url}) => {\n        this.props.setStyleUrl(url, name);\n      });\n    }\n  }\n\n  public openScriptLinkPicker(event){\n    if (this.linkPickerPanel) {\n      this.linkPickerPanel.pickLink()\n      .then (({name, url}) => {\n        this.props.setScriptUrl(url, name);\n      });\n    }\n  }\n\n  public copyTemplate(event){\n    const template = new Blob([this.templateExport], {type: \"text/html;charset=utf-8\"});\n    window[\"saveAs\"](template, \"example.html\");\n  }\n\n  public componentDidMount() {\n    if(this.props.jsUrl){\n      const script = document.createElement(\"script\");\n      script.src = this.props.jsUrl+\"?v=1.0\";\n      script.async = true;\n      document.body.appendChild(script);\n    }\n\n    if(this.props.cssUrl){\n      const link = document.createElement(\"link\");\n      link.href = this.props.cssUrl+\"?v=1.0\";\n      link.rel = \"stylesheet\";\n      link.type = \"text/css\";\n      document.head.appendChild(link);\n    }\n  }\n  \n  public render(): React.ReactElement<IHandlebarTemplateDisplayProps> {\n    const template = Handlebars.compile(this.props.template);\n    return (\n      <div>\n        <div className={styles[\"webpart-header\"]}>\n          { this.props.isEdit && <textarea onChange={this.setTitle.bind(this)} className={styles[\"edit\"]} placeholder={strings.TitlePlaceholder} aria-label=\"Add a title\" defaultValue={this.props.title}></textarea> }\n          { !this.props.isEdit && this.props.title && <span className={styles[\"view\"]}>{this.props.title}</span> }          \n        </div>\n        <div className={this.props.containerClass}>\n          {this.props.items.length > 0 && this.props.templateUrl && this.props.items.map((item) =>  this.templateRender(item, template) )}\n          {this.props.items.length > 0 && !this.props.templateUrl && this.noTemplateRender(this.props.items[0])}\n          {this.props.items.length===0 && !this.props.listIsSelected && this.renderConfigureWebPartView()}\n        </div>\n        <LinkPickerPanel\n          className={styles[\"link-picker\"]}\n          webPartContext={this.props.context}\n          webAbsUrl={this.props.context.pageContext.web.absoluteUrl}\n          linkType={ LinkType.any }\n          ref={ (ref) => {this.linkPickerPanel = ref;}} />\n      </div>\n    );\n  }\n\n  private templateRender(item, template): React.ReactElement<IHandlebarTemplateDisplayProps>{\n    return ( <span dangerouslySetInnerHTML={{__html:template(item)}}></span> );\n  }\n\n  private noTemplateRender(item): React.ReactElement<IHandlebarTemplateDisplayProps>{\n    this.templateExport = this.buildExampleTemplate(item);\n    const temaplate = Handlebars.compile(this.templateExport);\n    return (\n      <div>\n        <div style={{position: 'relative'}}>\n          <Button iconProps={{iconName: \"Download\"}}\n            style={{position: \"absolute\", right: '0', top: \"0\"}}\n            onClick={this.copyTemplate.bind(this)}>\n            {strings.DownloadButtonText}\n          </Button>\n          </div>\n        <div style={{border: '1px solid #DEDEDE', marginBottom: '5px', padding: '7px'}} dangerouslySetInnerHTML={{__html: temaplate(item)}}></div>\n      </div>\n    );\n  }\n\n  private buildExampleTemplate(obj, path = \"\"): string{\n    var template = \"\";\n    const separator = path ? \".\" : \"\";\n    for(var i in obj){\n      if(typeof obj[i] === 'object'){\n        template+=this.getLeadingTab(path)+'<div style=\"margin-left:10px;\">';\n        template+='\\n'+this.getLeadingTab(path)+'    <span style=\"font-weight:bold;\">';\n        template+=i+\": \";\n        template+=\"</span>\";\n        template+=\"\\n\"+this.getLeadingTab(path)+\"    <span>\";\n        template+=this.buildExampleTemplate(obj[i], path+separator+i);\n        template+=\"</span>\";\n        template+=\"\\n\"+this.getLeadingTab(path)+\"</div>\\n\";\n      }\n      else{\n       template+=this.getLeadingTab(path)+'<div style=\"margin-left:10px;\">';\n        template+='\\n'+this.getLeadingTab(path)+'    <span style=\"font-weight:bold;\">';\n        template+=i+\": \";\n        template+=\"</span>\";\n        template+=\"\\n\"+this.getLeadingTab(path)+'    <span style=\"word-wrap:break-word;\">';\n        template+=\"{{\"+path+separator+i+\"}}\";\n        template+=\"</span>\";\n        template+=this.getLeadingTab(path)+\"\\n</div>\\n\";\n      }\n    }\n\n    return template;\n  }\n\n  private getLeadingTab(path): string{\n    const periodFinder = new RegExp(/\\./g);\n    const periods = periodFinder.exec(path);\n    const periodCount = periods ? periods.length: 0;\n    var leading = \"\";\n    for(var i = 0; i < periodCount; i++){\n      leading += specialChar;\n    }\n    return leading;\n  }\n\n  private renderConfigureWebPartView(): React.ReactElement<IHandlebarTemplateDisplayProps>{\n    return (\n      <CommandButton iconProps={{iconName:\"Settings\"}}\n                     onClick={this.openPropertyPane.bind(this)}>\n        {strings.ConfigureWebPartButtonText}\n      </CommandButton>\n    );\n  }\n\n  private openPropertyPane(event){\n    this.props.context.propertyPane.open();\n  }\n}\n"],"sourceRoot":"..\\..\\..\\..\\src"}